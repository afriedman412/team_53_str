<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>STR Revenue Estimator — Chicago Strategy Group</title>
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Montserrat font to match the report -->
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
            rel="stylesheet">

        <style>
    :root {
      --gold: #C9A84A;
      --navy: #1E2A39;
      --light-blue: #A9C7E4;
      --cyan: #78D0F8;
      --light-gray: #F4F4F4;
      --white: #FFFFFF;
      --near-black: #1A1A1A;
    }

    body {
      font-family: 'Montserrat', sans-serif;
    }
  </style>
    </head>

    <body class="min-h-screen bg-[var(--light-gray)] text-[var(--near-black)]">

        <!-- GOLD HEADER BAR (like report cover) -->
        <div class="w-full bg-[var(--gold)] py-6 shadow-md">

            <div class="max-w-6xl mx-auto px-5 md:px-8 md:pl-28">
                <h1 class="text-3xl md:text-4xl font-semibold text-[var(--navy)] tracking-tight">
                    Short-Term Rental Revenue Estimator
                </h1>
            </div>
        </div>

        <!-- LEFT BRANDING BAR -->
        <div class="hidden md:flex fixed top-0 left-0 h-full w-1/6 min-w-[160px] max-w-[210px] shadow-lg z-20">
            <!-- Background skyline image -->
            <div class="absolute inset-0 bg-center bg-cover"
                style="background-image: url('/static/skyline.jpg');">
            </div>

            <!-- Navy overlay for contrast -->
            <div class="absolute inset-0"></div>

            <!-- Foreground: logo + small mark -->
                <div class="relative flex flex-col items-center justify-between pt-10 pb-6 w-full z-10">
                    
                    <!-- Bigger logo wrapper -->
                    <div class="w-40 h-40 md:w-48 md:h-48 overflow-hidden flex items-center justify-center">
                        <img
                        src="/static/csg_logo.png"
                        alt="Chicago Strategy Group"
                        class="w-56 md:w-64 h-auto -translate-y-3 drop-shadow-lg"
                        />
                    </div>

                    <!-- Tiny bottom mark -->
                    <span class="text-[var(--gold)] text-[10px] tracking-[0.35em] uppercase">
                        CSG
                    </span>
                
                </div>
            </div>
        </div>

        <div class="max-w-6xl mx-auto py-10 px-5 md:px-8 md:pl-28">

            <!-- Subtitle -->
            <p class="text-[var(--navy)]/80 mt-2 text-base md:text-lg mb-8">
                Estimate annual revenue and see how amenities move the needle.
            </p>

            <div class="grid gap-8 md:grid-cols-2 items-start">

                <!-- INPUT CARD -->
                <section
                    id="input-card"
                    class="bg-[var(--white)] shadow-lg rounded-xl p-8 space-y-6 border border-[var(--navy)]/10">

                    <h2 class="text-2xl font-semibold text-[var(--navy)] mb-4">
                        Listing Details
                    </h2>

                    <!-- Zillow URL -->
                    <div>
                        <label class="block font-medium text-[var(--navy)] mb-1">
                            Zillow URL
                        </label>
                        <input
                            id="zurl"
                            value="https://www.zillow.com/homedetails/555-W-Cornelia-Ave-APT-1011-Chicago-IL-60657/3717256_zpid/"
                            type="text"
                            class="w-full rounded-md px-3 py-2 border border-[var(--navy)]/20 bg-[var(--light-gray)]/50
                   focus:outline-none focus:ring-2 focus:ring-[var(--navy)]" />
                    </div>

                    <!-- Bedrooms + Bathrooms -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block font-medium text-[var(--navy)] mb-1">
                                Bedrooms
                            </label>
                            <input id="beds" value="2" type="number" min="0"
                                class="w-full rounded-md px-3 py-2 border border-[var(--navy)]/20 bg-[var(--light-gray)]/50
                     focus:outline-none focus:ring-2 focus:ring-[var(--navy)]" />
                        </div>

                        <div>
                            <label class="block font-medium text-[var(--navy)] mb-1">
                                Bathrooms
                            </label>
                            <input id="baths" value="2" type="number" min="0" step="0.5"
                                class="w-full rounded-md px-3 py-2 border border-[var(--navy)]/20 bg-[var(--light-gray)]/50
                     focus:outline-none focus:ring-2 focus:ring-[var(--navy)]" />
                        </div>
                    </div>

                    <!-- Accommodates -->
                    <div>
                        <label class="block font-medium text-[var(--navy)] mb-1">
                            Accommodates
                        </label>
                        <input id="accommodates" value="4" type="number" min="1"
                            class="w-full rounded-md px-3 py-2 border border-[var(--navy)]/20 bg-[var(--light-gray)]/50
                   focus:outline-none focus:ring-2 focus:ring-[var(--navy)]" />
                    </div>

                    <!-- Submit button -->
                    <button
                        id="submit-btn"
                        class="w-full bg-[var(--navy)] text-[var(--white)] py-3 rounded-lg text-lg font-semibold
                 hover:bg-[var(--gold)] hover:text-[var(--near-black)]
                 transition-colors shadow-md">
                        Estimate Revenue
                    </button>
                </section>

                <!-- OUTPUT CARD -->
                <section
                    id="output-section"
                    class="bg-[var(--white)] shadow-lg rounded-xl p-8 space-y-6 border border-[var(--navy)]/10 flex flex-col">

                    <div id="output-empty" class="text-[var(--navy)]/50 text-sm">
                        Fill in the form and click <span class="font-semibold">Estimate Revenue</span> to see results.
                    </div>

                    <div id="output-content" class="hidden space-y-6 flex-1">
                        <div class="space-y-2">
                            <p class="text-xs uppercase tracking-widest text-[var(--navy)]/50">
                                Estimate for
                            </p>
                            <h2 id="addr" class="text-2xl font-semibold text-[var(--navy)]"></h2>
                            <p id="rev" class="text-4xl font-bold text-[var(--gold)]"></p>
                            <p id="priceocc" class="text-sm text-[var(--navy)]/80"></p>
                        </div>

                        <div class="h-px bg-[var(--navy)]/10"></div>

                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold text-[var(--navy)]">
                                    Amenity Uplift
                                </h3>
                                <span class="text-xs rounded-full px-3 py-1 bg-[var(--navy)] text-[var(--white)]">
                                    Annual revenue delta
                                </span>
                            </div>

                            <div class="bg-[var(--light-gray)]/50 rounded-lg border border-[var(--navy)]/10 p-3">
                                <img id="uplift-img" class="w-full rounded-md shadow-sm" alt="Amenity uplift chart" />
                            </div>
                        </div>
                    </div>

                </section>

            </div>

        </div>
        <!-- LOADING OVERLAY -->
        <div id="loading-overlay"
            class="fixed inset-0 bg-black/20 backdrop-blur-sm hidden z-50 flex justify-center items-start pt-120 md:pt-40">

            <div class="flex flex-col items-center gap-4">
                <!-- Spinner -->
                <div class="w-12 h-12 border-4 border-[var(--navy)] border-t-[var(--gold)]
                rounded-full animate-spin"></div>

                <p class="text-[var(--navy)] font-semibold text-lg drop-shadow">
                    Evaluating property…
                </p>
            </div>
        </div>

        <!-- Existing JS preserved exactly -->
        <script>
  const btn = document.getElementById("submit-btn");
  const outEmpty = document.getElementById("output-empty");
  const outContent = document.getElementById("output-content");
  const overlay = document.getElementById("loading-overlay");

  const addrEl = document.getElementById("addr");
  const revEl = document.getElementById("rev");
  const priceOccEl = document.getElementById("priceocc");
  const upliftImgEl = document.getElementById("uplift-img");

  btn.onclick = async () => {
    const zurl = document.getElementById("zurl").value.trim();
    const beds = document.getElementById("beds").value;
    const baths = document.getElementById("baths").value;
    const acc = document.getElementById("accommodates").value;

    if (!zurl) {
      alert("Please enter a Zillow or Redfin URL.");
      return;
    }

    btn.disabled = true;
    overlay.classList.remove("hidden");

    try {
      const formData = new FormData();
      formData.append("url", zurl);
      formData.append("bedrooms", beds);
      formData.append("bathrooms", baths);
      formData.append("accommodates", acc);

      const res = await fetch("api/perms_from_url", {
        method: "POST",
        body: formData,
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        alert(err.detail || "Failed to estimate revenue.");
        return;
      }

      const data = await res.json();

      // ================================
      // POPULATE RESULTS
      // ================================

      const address = data.address || "Unknown address";
      const revenue = data.revenue ?? null;
      const price = data.price_pred ?? null;
      const occ = data.occ_pred ?? null;

      addrEl.innerText = address;

      if (revenue != null) {
        revEl.innerText = `$${Math.round(revenue).toLocaleString()} / yr`;
      } else {
        revEl.innerText = "—";
      }

      if (price != null && occ != null) {
        priceOccEl.innerText = `$${Math.round(
          price
        )} / night · ${Math.round(occ)} nights`;
      } else {
        priceOccEl.innerText = "";
      }

      if (data.uplift_chart_png) {
        upliftImgEl.src = "data:image/png;base64," + data.uplift_chart_png;
        upliftImgEl.alt = "Amenity uplift chart";
      } else {
        upliftImgEl.removeAttribute("src");
        upliftImgEl.alt = "No uplift chart available";
      }

      outEmpty.classList.add("hidden");
      outContent.classList.remove("hidden");

    } catch (err) {
      alert("Unexpected error while calling the API.");
    } finally {
      btn.disabled = false;
      overlay.classList.add("hidden");
    }
  };
</script>

    </body>
</html>
